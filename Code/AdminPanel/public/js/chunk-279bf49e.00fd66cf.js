(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-279bf49e"],{"15fa":function(t,e,s){},"4a30":function(t,e,s){"use strict";s("15fa")},8467:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("vue-element-loading",{attrs:{active:t.submitting,"is-full-screen":!0}}),s("v-card",{staticClass:"mx-auto",attrs:{"max-width":"500"}}),s("v-card",[s("v-card-title",[s("span",{staticClass:"me-3"},[t._v(t._s(t.route_name))]),s("v-spacer"),s("v-btn",{staticClass:"mx-1",attrs:{depressed:"",color:"secondary",to:"/routes"}},[t._v(" Cancel "),s("v-icon",{attrs:{right:"",dark:""}},[t._v(" mdi-keyboard-return ")])],1),s("v-btn",{staticClass:"mx-1",attrs:{depressed:"",color:"primary"},on:{click:t.saveRoute}},[t._v(" "+t._s(1==t.mode?"Update":"Save")+" "),s("v-icon",{attrs:{right:"",dark:""}},[t._v(" mdi-content-save ")])],1)],1),s("v-card-text",[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-4"},[s("v-list",[s("v-list-group",{attrs:{value:!1,"prepend-icon":"mdi-map-marker-plus"},on:{click:function(e){t.addStopOpen=!t.addStopOpen},input:t.addStopOpenClose},scopedSlots:t._u([{key:"activator",fn:function(){return[s("v-list-item-content",[s("v-list-item-title",{staticClass:"mb-2"},[t._v(" Add Stop")]),s("v-list-item-subtitle",[t._v("Total: "+t._s(t.stops.length)+" stops")])],1)]},proxy:!0}])},[s("v-list-item",[s("div",{staticClass:"row row--dense justify-space-between"},[s("div",{staticClass:"v-input v-input--hide-details v-input--dense theme--light v-text-field v-text-field--is-booted v-text-field--enclosed v-text-field--outlined v-text-field--placeholder"},[s("div",{staticClass:"v-input__control"},[s("div",{staticClass:"v-input__slot"},[s("fieldset",{attrs:{"aria-hidden":"true"}},[s("legend",{staticStyle:{width:"0px"}},[s("span",{staticClass:"notranslate"},[t._v("â€‹")])])]),s("div",{staticClass:"v-text-field__slot"},[s("GmapAutocomplete",{ref:"gmapAutocomplete",attrs:{id:"stop-address",placeholder:"Enter a location or click on map"},on:{place_changed:t.setPlace}})],1)])])]),s("v-btn",{attrs:{color:"primary",dark:"",small:"",icon:"",rounded:""},on:{click:function(e){return t.addMarker(null)}}},[s("v-icon",[t._v(" mdi-plus-thick ")])],1)],1)]),s("v-subheader",[t._v(" OR ")]),s("v-list-item",[s("div",{staticClass:"row row--dense justify-space-between align-center justify-center"},[s("v-col",{attrs:{cols:"12",md:"10"}},[s("v-autocomplete",{attrs:{items:t.items,loading:t.isSearching,"search-input":t.search,"hide-selected":"","item-text":"Description",label:"Choose from saved stops",placeholder:"Start typing to Search","return-object":""},on:{"update:searchInput":function(e){t.search=e},"update:search-input":function(e){t.search=e},change:t.stopSelected},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}})],1),s("v-btn",{attrs:{color:"primary",dark:"",small:"",icon:"",rounded:""},on:{click:t.addSavedStop}},[s("v-icon",[t._v(" mdi-plus-thick ")])],1)],1)])],1)],1),s("v-divider"),t._l(t.stops,(function(e,o){return s("div",{key:e.place_id,staticClass:"list-group-item pa-2",class:t.selectedIdx==o?"active-stop":"",on:{click:function(s){t.selectedItem=e.place_id,t.selectedIdx=o}}},[s("div",{staticClass:"font-weight-bold text-dark m-1 my-1"},[t._v(" "+t._s(e.name)+" ")]),s("div",{staticClass:"text-dark m-1 my-1"},[t._v(" "+t._s(e.address)+" ")]),s("div",{staticClass:"text-dark m-1 my-4"},[0!==o?s("div",[s("v-select",{staticClass:"mr-2",attrs:{items:null!=t.ordered_directions[o-1]?t.ordered_directions[o-1]:[],"item-text":function(t){return t.summary},"item-value":function(t){return t.index},label:"Route from previous stop"},model:{value:t.chosen_routes[o-1],callback:function(e){t.$set(t.chosen_routes,o-1,e)},expression:"chosen_routes[index - 1]"}})],1):t._e()]),s("div",{staticClass:"d-flex justify-space-between m-1 my-1 align-center"},[s("div",[s("span",{staticClass:"font-weight-light mr-2"},[t._v(" Stop")]),s("v-badge",{attrs:{content:o+1,inline:""}})],1),s("div",[s("v-btn",{attrs:{icon:"",color:"error"},on:{click:function(e){return t.deleteMarker(o)}}},[s("v-icon",{attrs:{dark:""}},[t._v(" mdi-trash-can ")])],1)],1)])])}))],2),s("div",{staticClass:"col-md-8",attrs:{id:"map"}},[s("GoogleMapLoader",{attrs:{enabled:t.addStopOpen,center:t.center,selected:t.selectedItem,zoom:t.zoom,apiKey:t.apiKey,markers:t.markers,polylines:t.polyline},on:{"map-click":t.handleMapClick}})],1)])])],1)],1)},i=[],n=s("3835"),r=(s("acd8"),s("d81d"),s("b64b"),s("d3b7"),s("ddb0"),s("b0c0"),s("c7cd"),s("a434"),s("498a"),s("99af"),s("a4d3"),s("e01a"),s("ac1f"),s("5319"),s("4160"),s("159b"),s("bc3a")),a=s.n(r),l=s("012a"),c=s("b76a"),d=s.n(c),u=s("6ad0"),p=s.n(u),h=s("db49");$(window).scroll((function(){$("#map").stop().animate({marginTop:$(window).scrollTop()+"px",marginLeft:$(window).scrollLeft()+"px"},"slow")}));var m={components:{GoogleMapLoader:l["a"],draggable:d.a,VueElementLoading:p.a,Keys:h["a"]},data:function(){return{apiKey:h["a"].GOOGLE_MAPS_API_KEY,descriptionLimit:60,entries:[],isSearching:!1,model:null,search:null,route_name:null,route_id:null,markers:[],selectedIdx:null,currentPlace:null,stops:[],center:{lat:h["a"].VUE_APP_ORIGIN_LAT,lng:h["a"].VUE_APP_ORIGIN_LNG},zoom:12,selectedItem:null,editable:!0,isDragging:!1,delayedDragging:!1,addStopOpen:!1,submitting:!1,mode:null,selectedSavedStop:null,ordered_directions:[],chosen_routes:[],polyline:[],colors:["#000000","#FF0000","#0000FF","#FF00FF","#808080","#800000","#008000","#800080","#008080","#000080"]}},mounted:function(){this.center.lat=parseFloat(this.center.lat),this.center.lng=parseFloat(this.center.lng),this.loadAllStops(),null!=this.$route.params.route_name?(this.mode=0,this.geolocate(),this.route_name=this.$route.params.route_name):null!=this.$route.params.route_id&&(this.mode=1,this.route_id=this.$route.params.route_id,this.route_name=this.$route.params.new_route_name,console.log(this.route_name),this.fetchStops())},watch:{search:function(t){this.items.length>0||this.isSearching||this.loadAllStops()},isDragging:function(t){var e=this;t?this.delayedDragging=!0:this.$nextTick((function(){e.delayedDragging=!1}))},stops:function(t){console.log("stops changed")},chosen_routes:function(t){this.setup_polyline()}},computed:{dragOptions:function(){return{animation:0,group:"description",disabled:!this.editable,ghostClass:"ghost"}},fields:function(){var t=this;return this.model?Object.keys(this.model).map((function(e){return{key:e,value:t.model[e]||"n/a"}})):[]},items:function(){return this.entries.map((function(t){var e=t.name;return Object.assign({},t,{Description:e})}))}},methods:{loadAllStops:function(){var t=this;this.isSearching=!0,a.a.get("/stops/all").then((function(e){t.entries=e.data,t.count=t.entries.length}))["catch"]((function(e){t.$notify({title:"Error",text:"Error while retrieving stops",type:"error"}),console.log(e)})).then((function(){t.isSearching=!1}))},stopSelected:function(t){t.lat=parseFloat(t.lat),t.lng=parseFloat(t.lng),this.selectedSavedStop=t},addSavedStop:function(){if(null!=this.selectedSavedStop&&(this.stops.push(this.selectedSavedStop),this.addMarker(this.selectedSavedStop),this.selectedSavedStop=null,this.stops.length>1)){var t=this.stops[this.stops.length-1],e=this.stops[this.stops.length-2];this.getAddedStopRoute(t,e)}},addStopOpenClose:function(){var t=this;this.$nextTick((function(){t.$refs.gmapAutocomplete.$el.focus(),t.$refs.gmapAutocomplete.$el.value=""}))},onMove:function(t){var e=t.relatedContext,s=t.draggedContext;console.log("onMove"),this.redoDirections();var o=e.element,i=s.element;return this.selectedIdx=-1,this.selectedItem=null,(!o||!o.fixed)&&!i.fixed},setPlace:function(t){this.currentPlace=t},deleteMarker:function(t){var e=this;this.$swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!"}).then((function(s){if(s.isConfirmed){for(var o=0;o<e.markers.length;o++)if(e.markers[o].place_id==e.stops[t].place_id){e.markers.splice(o,1);break}e.redoDirections(t),e.stops.splice(t,1),e.$notify({title:"Success",text:"Stop deleted!",type:"success"})}}))},handleMapClick:function(t){this.currentPlace=t,console.log(this.currentPlace),this.addMarker()},addMarker:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;console.log(e),null==e?this.$swal.fire({title:"Enter stop name",input:"text",inputValue:"Stop "+(this.stops.length+1),showCancelButton:!0}).then((function(s){if(s.isConfirmed){var o=s.value.trim();t.addStop(e,o)}})):this.addStop(e)},addStop:function(t,e){var s=this,o=null!=t?t:this.getStopFromPlace(this.currentPlace,e);if(o){var i={lat:parseFloat(o.lat),lng:parseFloat(o.lng)};if(this.markers.push({place_id:o.place_id,position:i,infoText:"<strong>"+o.name+"</strong><br/>"+o.address}),null==t&&(this.stops.push(o),this.stops.length>1)){var n=this.stops[this.stops.length-1],r=this.stops[this.stops.length-2];this.getAddedStopRoute(n,r)}this.currentPlace=null,null!=this.$refs.gmapAutocomplete&&(this.$refs.gmapAutocomplete.$el.value="",this.$nextTick((function(){s.$refs.gmapAutocomplete.$el.focus()})))}},getAddedStopRoute:function(t,e){var s=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.submitting=!0,a.a.get("/google-routes/compute-route?origin_lat=".concat(e.lat,"&origin_lng=").concat(e.lng,"&destination_lat=").concat(t.lat,"&destination_lng=").concat(t.lng)).then((function(t){console.log(t.data);var e=t.data.routes.map((function(t,e){return{summary:null==t.description||""==t.description?"Route "+(e+1):t.description,overview_path:t.polyline.geoJsonLinestring.coordinates.map((function(t){var e=Object(n["a"])(t,2),s=e[0],o=e[1];return{lat:o,lng:s}})),index:e}}));null==o?(s.ordered_directions.push(e),s.chosen_routes.push(0)):(s.ordered_directions[o]=e,s.chosen_routes[o]=0),s.setup_polyline(),s.submitting=!1}))["catch"]((function(t){s.submitting=!1,s.$swal.fire({title:"Error",text:"Could not get directions",icon:"error",confirmButtonText:"OK"})}))},redoDirections:function(t){var e=this;if(0==t)this.ordered_directions.splice(t,1),this.chosen_routes.splice(t,1),this.setup_polyline();else if(t==this.stops.length-1)this.ordered_directions.splice(t-1,1),this.chosen_routes.splice(t-1,1),this.setup_polyline();else{this.ordered_directions.splice(t,1),this.chosen_routes.splice(t,1);var s=this.stops[t-1],o=this.stops[t+1];this.submitting=!0,a.a.get("/google-routes/compute-route?origin_lat=".concat(s.lat,"&origin_lng=").concat(s.lng,"&destination_lat=").concat(o.lat,"&destination_lng=").concat(o.lng)).then((function(s){console.log(s.data);var o=s.data.routes.map((function(t,e){return{summary:null==t.description||""==t.description?"Route "+(e+1):t.description,overview_path:t.polyline.geoJsonLinestring.coordinates.map((function(t){var e=Object(n["a"])(t,2),s=e[0],o=e[1];return{lat:o,lng:s}})),index:e}}));e.ordered_directions[t-1]=o,e.chosen_routes[t-1]=0,e.setup_polyline(),e.submitting=!1}))["catch"]((function(t){e.submitting=!1,e.$swal.fire({title:"Error",text:"Could not get directions",icon:"error",confirmButtonText:"OK"})}))}},randomColor:function(){return this.colors[Math.floor(Math.random()*this.colors.length)]},setup_polyline:function(){this.polyline=[];for(var t=0;t<this.ordered_directions.length;t++)if(this.ordered_directions[t].length>this.chosen_routes[t]){var e={data:this.ordered_directions[t][this.chosen_routes[t]].overview_path,strokeColor:this.randomColor()};this.polyline.push(e)}},getStopFromPlace:function(t,e){var s={name:e,place_id:t.place_id,address:t.formatted_address,lat:t.geometry.location.lat(),lng:t.geometry.location.lng(),fixed:!1,new:!0};return s},getStopId:function(){for(var t=-1,e=0;e<this.stops.length;e++)this.stops[e].id>t&&(t=this.stops[e].id);return t},geolocate:function(){var t=this;navigator.geolocation.getCurrentPosition((function(e){t.center={lat:e.coords.latitude,lng:e.coords.longitude}}))},saveRoute:function(){var t=this;this.submitting=!0,a.a.post("/routes/create-edit",{id:this.route_id,route:this.route_name,stops:this.stops,chosen_routes:this.chosen_routes,ordered_directions:this.ordered_directions}).then((function(e){t.submitting=!1,t.$notify({title:"Success",text:"Route created!",type:"success"}),t.$router.replace({name:"routes"})}))["catch"]((function(e){t.submitting=!1,t.$notify({title:"Error",text:"Error creating route",type:"error"}),console.log(e),t.$swal("Error",e.response.data.message,"error")}))},fetchStops:function(){var t=this;this.submitting=!0,a.a.get("/routes/".concat(this.route_id)).then((function(e){t.geolocate();var s=e.data.stops;s.forEach((function(t,e){t.lat=parseFloat(t.lat),t.lng=parseFloat(t.lng)})),t.stops=s;for(var o=0;o<t.stops.length;o++)t.addMarker(t.stops[o]);t.ordered_directions=e.data.directions;for(var i=0;i<t.ordered_directions.length;i++)for(var n=0;n<t.ordered_directions[i].length;n++){var r=t.ordered_directions[i][n];if(1===r.current){t.chosen_routes[i]=n;break}}t.setup_polyline(),t.submitting=!1}))["catch"]((function(e){t.submitting=!1,t.$notify({title:"Error",text:"Error fetching stops of this route",type:"error"}),console.log(e),t.$router.replace({name:"routes"})}))}}},g=m,f=(s("4a30"),s("b9e8"),s("2877")),v=s("6544"),_=s.n(v),b=s("c6a6"),S=s("4ca6"),y=s("8336"),x=s("b0af"),k=s("99d9"),C=s("62ad"),w=s("ce7e"),V=s("132d"),A=s("8860"),I=s("56b0"),O=s("da13"),E=s("5d23"),F=s("b974"),L=s("2fa4"),P=s("e0c7"),M=Object(f["a"])(g,o,i,!1,null,null,null);e["default"]=M.exports;_()(M,{VAutocomplete:b["a"],VBadge:S["a"],VBtn:y["a"],VCard:x["a"],VCardText:k["b"],VCardTitle:k["c"],VCol:C["a"],VDivider:w["a"],VIcon:V["a"],VList:A["a"],VListGroup:I["a"],VListItem:O["a"],VListItemContent:E["a"],VListItemSubtitle:E["b"],VListItemTitle:E["c"],VSelect:F["a"],VSpacer:L["a"],VSubheader:P["a"]})},"90da":function(t,e,s){},b9e8:function(t,e,s){"use strict";s("90da")}}]);
//# sourceMappingURL=chunk-279bf49e.00fd66cf.js.map
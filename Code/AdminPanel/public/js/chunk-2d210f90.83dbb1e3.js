(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d210f90"],{b9be:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-card",[a("v-card-title",[a("v-icon",{attrs:{color:"primary"}},[e._v(" mdi-poll ")]),a("span",{staticClass:"pl-2"},[e._v("Reservations")])],1),a("v-tabs",{staticClass:"my-2",attrs:{"show-arrows":""},model:{value:e.active_tab,callback:function(t){e.active_tab=t},expression:"active_tab"}},e._l(e.tabs,(function(t){return a("v-tab",{key:t.idx},[a("v-icon",{staticClass:"me-3",attrs:{size:"20"}},[e._v(" "+e._s(t.icon)+" ")]),a("span",[e._v(e._s(t.title))])],1)})),1),a("v-tabs-items",{model:{value:e.active_tab,callback:function(t){e.active_tab=t},expression:"active_tab"}},[a("v-tab-item",[a("reservations-table",{attrs:{"show-cancel":!0,loading:e.isLoading,reservations:e.activeReservations},on:{"cancel-reservation":e.cancelReservation}})],1),a("v-tab-item",[a("reservations-table",{attrs:{"show-cancel":!0,loading:e.isLoading,reservations:e.rideReservations},on:{"cancel-reservation":e.cancelReservation}})],1),a("v-tab-item",[a("reservations-table",{attrs:{"show-cancel":!0,loading:e.isLoading,reservations:e.missedReservations},on:{"cancel-reservation":e.cancelReservation}})],1),a("v-tab-item",[a("reservations-table",{attrs:{"show-cancel":!0,loading:e.isLoading,reservations:e.completedReservations},on:{"cancel-reservation":e.cancelReservation}})],1),a("v-tab-item",[a("reservations-table",{attrs:{"show-cancel":!1,loading:e.isLoading,reservations:e.cancelledReservations}})],1)],1)],1)],1)},i=[],s=(a("e25e"),a("a434"),a("94ed")),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-data-table",{attrs:{"item-key":"name",loading:e.loading,"loading-text":"Loading... Please wait",headers:e.headers,items:e.reservations,search:e.search},scopedSlots:e._u([{key:"top",fn:function(){return[a("v-text-field",{staticClass:"mx-4",attrs:{label:"Search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]},proxy:!0},{key:"item.planned_trip.route.name",fn:function(t){var n=t.item;return[a("a",{on:{click:function(t){return t.stopPropagation(),e.displayRoute(n.planned_trip.route.id)}}},[e._v(e._s(n.planned_trip.route.name))])]}},{key:"item.customer.name",fn:function(t){var n=t.item;return[a("a",{on:{click:function(t){return t.stopPropagation(),e.displayCustomer(n.customer.id)}}},[e._v(e._s(n.customer.name))])]}},{key:"item.planned_trip.driver.name",fn:function(t){var n=t.item;return[a("a",{on:{click:function(t){return t.stopPropagation(),e.displayDriver(n.planned_trip.driver.id)}}},[e._v(e._s(n.planned_trip.driver.name))])]}},{key:"item.first_stop.name",fn:function(t){var n=t.item;return[a("a",{on:{click:function(t){return t.stopPropagation(),e.displayStop(n.first_stop.id)}}},[e._v(e._s(n.first_stop.name))])]}},{key:"item.last_stop.name",fn:function(t){var n=t.item;return[a("a",{on:{click:function(t){return t.stopPropagation(),e.displayStop(n.last_stop.id)}}},[e._v(e._s(n.last_stop.name))])]}},{key:"item.paid_price",fn:function(t){var n=t.item;return[a("small",[e._v(e._s(Math.round(100*n.paid_price)/100))])]}},{key:"item.planned_trip.planned_date",fn:function(t){var n=t.item;return[a("small",[e._v(e._s(e._f("moment")(n.planned_trip.planned_date,"LL")))]),e._v(" - "),a("small",{staticClass:"text-muted"},[e._v(e._s(n.planned_start_time))])]}},{key:"item.created_at",fn:function(t){var n=t.item;return[a("small",[e._v(e._s(e._f("moment")(n.created_at,"LL")))])]}},{key:"item.actions",fn:function(t){var n=t.item;return[a("v-btn",{attrs:{depressed:"",small:"",density:"compact",color:"error",icon:!0},on:{click:function(t){e.cancelReservation(n,e.reservations.indexOf(n))}}},[a("v-icon",{attrs:{dark:""}},[e._v(" mdi-bank-minus ")])],1)]}}])})},o=[],c=(a("99af"),{props:{reservations:Array,showCancel:Boolean,loading:{type:Boolean,default:!1}},components:{},data:function(){return{search:"",headers:[{text:"ID",value:"id",align:"start",filterable:!1},{text:"Ticket",value:"ticket_number"},{text:"Customer",value:"customer.name"},{text:"Driver",value:"planned_trip.driver.name"},{text:"Route",value:"planned_trip.route.name"},{text:"From",value:"first_stop.name"},{text:"To",value:"last_stop.name"},{text:"Time of trip",value:"planned_trip.planned_date"},{text:"Paid price",value:"paid_price"},{text:"Reserved on",value:"created_at"}]}},mounted:function(){var e=this.headers;this.showCancel&&(e=this.headers.concat({text:"Cancel",value:"actions",sortable:!1})),this.headers=e},methods:{displayRoute:function(e){this.$router.push({name:"view-route",params:{route_id:e}})},displayCustomer:function(e){this.$router.push({name:"view-user",params:{user_id:e}})},displayDriver:function(e){this.$router.push({name:"view-user",params:{user_id:e}})},displayStop:function(e){this.$router.push({name:"view-stop",params:{stop_id:e}})},cancelReservation:function(e,t){this.$emit("cancel-reservation",e,t)}}}),l=c,d=a("2877"),v=a("6544"),u=a.n(v),m=a("8336"),p=a("8fea"),f=a("132d"),_=a("8654"),h=Object(d["a"])(l,r,o,!1,null,null,null),b=h.exports;u()(h,{VBtn:m["a"],VDataTable:p["a"],VIcon:f["a"],VTextField:_["a"]});var y={components:{reservationsTable:b},data:function(){return{activeReservations:[],rideReservations:[],completedReservations:[],missedReservations:[],cancelledReservations:[],isLoading:!1,selectedReservation:null,search:"",tabs:[{idx:0,title:"Upcoming",icon:s["O"]},{idx:1,title:"Ride",icon:s["b"]},{idx:2,title:"Missed",icon:s["d"]},{idx:3,title:"Completed",icon:s["a"]},{idx:4,title:"Cancelled",icon:s["N"]}],active_tab:null,icons:{mdiStopCircleOutline:s["Q"],mdiAccountCheck:s["a"],mdiAccountOff:s["d"],mdiAccountClock:s["b"],mdiPlayCircleOutline:s["O"],mdiTrashCan:s["S"],mdiDeleteRestore:s["w"],mdiAirplane:s["f"]}}},watch:{active_tab:function(e,t){localStorage.tabIdxReservations=e}},mounted:function(){this.active_tab=parseInt(localStorage.tabIdxReservations),this.loadReservations()},methods:{loadReservations:function(){var e=this;this.isLoading=!0,this.reservations=[],axios.get("/reservations/all").then((function(t){e.activeReservations=t.data.active,e.rideReservations=t.data.ride,e.completedReservations=t.data.completed,e.missedReservations=t.data.missed,e.cancelledReservations=t.data.cancelled}))["catch"]((function(t){e.$notify({title:"Error",text:"Error while retrieving reservations",type:"error"}),console.log(t),e.$swal("Error",t.response.data.message,"error")})).then((function(){e.isLoading=!1}))},cancelReservation:function(e,t){var a=this,n="";n=this.active_tab>=1&&this.active_tab<=3?"You are about to cancel this reservation. The customer will get a refund. Please note that the reservation may be redeemed by the admin or the driver. If so, you will be informed by the system and you will have to manually deduct the amount from the payment account.":"You are about to cancel this reservation. The customer will get a refund.",this.$swal({title:"Are you sure?",text:n,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, cancel it!"}).then((function(n){n.isConfirmed&&axios.post("/reservations/cancel",{id:e.id,reason:"Cancelled by admin"}).then((function(e){a.$notify({title:"Success",text:"Reservation cancelled successfully",type:"success"}),201==e.status&&a.$swal("Info",e.data.message,"info");var n=null;0==a.active_tab?(n=a.activeReservations[t],a.activeReservations.splice(t,1)):1==a.active_tab?(n=a.rideReservations[t],a.rideReservations.splice(t,1)):2==a.active_tab?(n=a.missedReservations[t],a.missedReservations.splice(t,1)):3==a.active_tab&&(n=a.completedReservations[t],a.completedReservations.splice(t,1)),a.cancelledReservations.push(n)}))["catch"]((function(e){a.$notify({title:"Error",text:"Error while cancelling reservation",type:"error"}),console.log(e),a.$swal("Error",e.response.data.message,"error")}))}))}}},R=y,g=a("b0af"),x=a("99d9"),w=a("71a3"),k=a("c671"),C=a("fe57"),T=a("aac8"),$=Object(d["a"])(R,n,i,!1,null,null,null);t["default"]=$.exports;u()($,{VCard:g["a"],VCardTitle:x["c"],VIcon:f["a"],VTab:w["a"],VTabItem:k["a"],VTabs:C["a"],VTabsItems:T["a"]})}}]);
//# sourceMappingURL=chunk-2d210f90.83dbb1e3.js.map